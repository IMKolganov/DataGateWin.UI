<Page x:Class="DataGateWin.Pages.Statistics"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
      xmlns:oxy="http://oxyplot.org/wpf"
      Loaded="OnLoaded">

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="12"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="12"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="12"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <ui:TextBlock Grid.Row="0"
                      Text="Statistics"
                      FontTypography="Title"
                      FontSize="20"
                      Foreground="{DynamicResource TextFillColorPrimaryBrush}"
                      FontWeight="SemiBold"/>

        <!-- Filters -->
        <Border Grid.Row="2"
                Padding="12"
                CornerRadius="12"
                Background="{DynamicResource CardBackgroundFillColorDefaultBrush}">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="10"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <WrapPanel Grid.Row="0" VerticalAlignment="Center">
                    <ui:TextBlock Text="From" Margin="0,0,8,0" VerticalAlignment="Center"/>
                    <DatePicker SelectedDate="{Binding FromLocalDate, Mode=TwoWay}"
                                Width="140"/>

                    <ui:TextBlock Text="To" Margin="16,0,8,0" VerticalAlignment="Center"/>
                    <DatePicker SelectedDate="{Binding ToLocalDate, Mode=TwoWay}"
                                Width="140"/>

                    <ui:TextBlock Text="Grouping" Margin="16,0,8,0" VerticalAlignment="Center"/>
                    <ComboBox ItemsSource="{Binding GroupingItems}"
                              SelectedItem="{Binding Grouping, Mode=TwoWay}"
                              Width="140"/>
                </WrapPanel>

                <WrapPanel Grid.Row="2" VerticalAlignment="Center">
                    <Button Content="7 days"
                            Command="{Binding SetLastDaysCommand}"
                            CommandParameter="7"
                            Margin="0,0,8,0"/>

                    <Button Content="30 days"
                            Command="{Binding SetLastDaysCommand}"
                            CommandParameter="30"
                            Margin="0,0,8,0"/>

                    <Button Content="90 days"
                            Command="{Binding SetLastDaysCommand}"
                            CommandParameter="90"
                            Margin="0,0,16,0"/>

                    <Button Content="Apply"
                            Command="{Binding ApplyFiltersCommand}"
                            Margin="0,0,8,0"/>

                    <Button Content="Reset"
                            Command="{Binding ResetFiltersCommand}"
                            Margin="0,0,16,0"/>

                    <ui:TextBlock Text="{Binding ErrorText}"
                                  Foreground="Tomato"
                                  VerticalAlignment="Center"/>
                </WrapPanel>
            </Grid>
        </Border>

        <!-- Summary -->
        <Border Grid.Row="4"
                Padding="12"
                CornerRadius="12"
                Background="{DynamicResource CardBackgroundFillColorDefaultBrush}">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel>
                    <ui:TextBlock Text="Uploaded"
                                  FontTypography="BodyStrong"
                                  Foreground="{DynamicResource TextFillColorSecondaryBrush}"/>
                    <ui:TextBlock Text="{Binding TotalUploadedText}"
                                  FontSize="24"
                                  FontWeight="SemiBold"
                                  Foreground="{DynamicResource TextFillColorPrimaryBrush}"/>
                    <ui:TextBlock Text="{Binding PeriodText}"
                                  Foreground="{DynamicResource TextFillColorTertiaryBrush}"/>
                </StackPanel>

                <ui:ProgressRing Grid.Column="1"
                                 Width="28"
                                 Height="28"
                                 IsIndeterminate="True"
                                 Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}"/>
            </Grid>
        </Border>

        <!-- Chart -->
        <Border Grid.Row="6"
                Padding="12"
                CornerRadius="12"
                Background="{DynamicResource CardBackgroundFillColorDefaultBrush}">
            <oxy:PlotView x:Name="Chart" Model="{Binding PlotModel}" />
        </Border>
    </Grid>
</Page>
