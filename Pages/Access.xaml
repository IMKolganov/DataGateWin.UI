<Page x:Class="DataGateWin.Pages.Access"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
      xmlns:utils="clr-namespace:DataGateWin.ViewModels.Utils">
    
    <Page.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVis"/>
        <utils:BytesToHumanReadableConverter x:Key="BytesFmt"/>
    </Page.Resources>

    <Grid Margin="20" RowDefinitions="Auto,Auto,*">

        <!-- Header -->
        <ui:TextBlock Grid.Row="0"
                      Text="Access"
                      FontTypography="Title"
                      FontSize="20"
                      Foreground="{DynamicResource TextFillColorPrimaryBrush}"
                      FontWeight="SemiBold"/>
        
        <!-- Loading / Error -->
        <Grid Grid.Row="1" Margin="0,12,0,12">
            <ui:ProgressRing
                IsIndeterminate="True"
                Visibility="{Binding IsLoading, Converter={StaticResource BoolToVis}}"/>

            <TextBlock
                Text="{Binding ErrorText}"
                Foreground="Red">
                <TextBlock.Style>
                    <Style TargetType="TextBlock">
                        <Setter Property="Visibility" Value="Visible"/>
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding ErrorText}" Value="{x:Null}">
                                <Setter Property="Visibility" Value="Collapsed"/>
                            </DataTrigger>
                            <DataTrigger Binding="{Binding ErrorText}" Value="">
                                <Setter Property="Visibility" Value="Collapsed"/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </TextBlock.Style>
            </TextBlock>
        </Grid>

        <!-- Servers -->
        <ui:DataGrid
            Grid.Row="2"
            ItemsSource="{Binding Servers}"
            AutoGenerateColumns="False"
            IsReadOnly="True"
            CanUserAddRows="False"
            CanUserDeleteRows="False"
            CanUserResizeRows="False"
            CanUserReorderColumns="False"
            CanUserSortColumns="True"
            SelectionMode="Single"
            SelectionUnit="FullRow"
            HeadersVisibility="Column"
            GridLinesVisibility="All"
            HorizontalGridLinesBrush="{DynamicResource ControlStrokeColorDefaultBrush}"
            VerticalGridLinesBrush="{DynamicResource ControlStrokeColorDefaultBrush}"
            BorderThickness="1"
            BorderBrush="{DynamicResource ControlStrokeColorDefaultBrush}"
            RowHeaderWidth="0">

            <ui:DataGrid.Columns>

                <DataGridTextColumn
                    Header="Server"
                    Binding="{Binding OpenVpnServerResponses.OpenVpnServer.ServerName}"
                    Width="*" />

                <DataGridTextColumn
                    Header="Clients"
                    Binding="{Binding CountConnectedClients}"
                    Width="90"/>

                <DataGridTextColumn
                    Header="In"
                    Binding="{Binding TotalBytesIn, Converter={StaticResource BytesFmt}, ConverterParameter=IEC}"
                    Width="120"/>

                <DataGridTextColumn
                    Header="Out"
                    Binding="{Binding TotalBytesOut, Converter={StaticResource BytesFmt}, ConverterParameter=IEC}"
                    Width="120"/>

                <DataGridCheckBoxColumn
                    Header="Online"
                    Binding="{Binding OpenVpnServerResponses.OpenVpnServer.IsOnline}"
                    Width="90">
                    <DataGridCheckBoxColumn.ElementStyle>
                        <Style TargetType="CheckBox">
                            <Setter Property="IsEnabled" Value="False"/>
                            <Setter Property="HorizontalAlignment" Value="Center"/>
                        </Style>
                    </DataGridCheckBoxColumn.ElementStyle>
                </DataGridCheckBoxColumn>

            </ui:DataGrid.Columns>
        </ui:DataGrid>

    </Grid>
</Page>
